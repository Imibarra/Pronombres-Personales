<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clasificador de Pronombres Personales</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para el cursor y elementos interactivos */
        .word:hover {
            cursor: pointer;
            text-decoration: underline;
        }
        .correct-pronoun {
            background-color: #10B981; /* Esmeralda 500 */
            color: white;
            border-radius: 0.5rem;
            padding: 2px 6px;
        }
        .incorrect-selection {
            background-color: #EF4444; /* Rojo 500 */
            color: white;
            border-radius: 0.5rem;
            padding: 2px 6px;
        }
        .classification-button.active {
            opacity: 1;
            cursor: pointer;
        }
        .classification-button.inactive {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .classification-button.selected {
            border: 3px solid #FCD34D; /* Amarillo 300 */
            background-color: #FEF3C7; /* Amarillo 100 */
        }
        .classification-button.correct {
            border: 3px solid #059669; /* Verde 600 */
            background-color: #D1FAE5; /* Verde 100 */
        }
        .classification-button.incorrect {
            border: 3px solid #B91C1C; /* Rojo 700 */
            background-color: #FEE2E2; /* Rojo 100 */
        }
    </style>
</head>
<body class="bg-gray-50 font-sans min-h-screen flex flex-col items-center p-4">

    <!-- Contenedor Principal -->
    <div class="w-full max-w-4xl bg-white shadow-xl rounded-2xl p-6 md:p-10 my-8">

        <h1 class="text-3xl md:text-4xl font-extrabold text-indigo-700 text-center mb-6">
            Análisis de Pronombres Personales
        </h1>
        <p class="text-lg text-gray-600 text-center mb-8">
            Selecciona el pronombre en la oración y clasifícalo. (Total: 30 preguntas)
        </p>

        <!-- Área de la Oración -->
        <div id="sentence-container" class="min-h-[100px] border-2 border-dashed border-indigo-200 bg-indigo-50 p-6 rounded-xl mb-8 flex items-center justify-center">
            <p id="current-sentence" class="text-2xl text-gray-800 font-medium leading-relaxed text-center">
                <!-- La oración se renderizará aquí -->
                Cargando oración...
            </p>
        </div>

        <!-- Mensajes de Feedback y Progreso -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 space-y-4 md:space-y-0">
            <p id="feedback-message" class="text-lg font-semibold text-center h-6"></p>
            <div class="text-xl font-bold text-gray-700">
                <!-- El progreso se actualizará aquí con el formato "Pregunta X de Y | Quedan Z" -->
                <span id="progress-display" class="text-indigo-600">Cargando...</span>
            </div>
        </div>

        <!-- Área de Clasificación -->
        <div id="classification-area" class="space-y-6">

            <!-- 1. Tónico o Átono -->
            <div id="step-type" class="p-4 border border-gray-200 rounded-lg">
                <h3 class="text-xl font-semibold mb-3 text-gray-700">1. Tipo (Tónico o Átono)</h3>
                <div class="flex flex-wrap gap-3">
                    <button data-value="tónico" data-category="type" class="classification-button inactive px-5 py-2 rounded-xl text-lg font-medium transition duration-200 bg-gray-100 hover:bg-gray-200">Tónico</button>
                    <button data-value="átono" data-category="type" class="classification-button inactive px-5 py-2 rounded-xl text-lg font-medium transition duration-200 bg-gray-100 hover:bg-gray-200">Átono</button>
                </div>
            </div>

            <!-- 2. Persona -->
            <div id="step-person" class="p-4 border border-gray-200 rounded-lg">
                <h3 class="text-xl font-semibold mb-3 text-gray-700">2. Persona</h3>
                <div class="flex flex-wrap gap-3">
                    <button data-value="1" data-category="person" class="classification-button inactive px-5 py-2 rounded-xl text-lg font-medium transition duration-200 bg-gray-100 hover:bg-gray-200">1ª Persona</button>
                    <button data-value="2" data-category="person" class="classification-button inactive px-5 py-2 rounded-xl text-lg font-medium transition duration-200 bg-gray-100 hover:bg-gray-200">2ª Persona</button>
                    <button data-value="3" data-category="person" class="classification-button inactive px-5 py-2 rounded-xl text-lg font-medium transition duration-200 bg-gray-100 hover:bg-gray-200">3ª Persona</button>
                </div>
            </div>

            <!-- 3. Número -->
            <div id="step-number" class="p-4 border border-gray-200 rounded-lg">
                <h3 class="text-xl font-semibold mb-3 text-gray-700">3. Número</h3>
                <div class="flex flex-wrap gap-3">
                    <button data-value="singular" data-category="number" class="classification-button inactive px-5 py-2 rounded-xl text-lg font-medium transition duration-200 bg-gray-100 hover:bg-gray-200">Singular</button>
                    <button data-value="plural" data-category="number" class="classification-button inactive px-5 py-2 rounded-xl text-lg font-medium transition duration-200 bg-gray-100 hover:bg-gray-200">Plural</button>
                </div>
            </div>

            <!-- Botón de Siguiente/Reiniciar -->
            <div class="pt-4 flex justify-end">
                <button id="next-button" class="bg-indigo-500 text-white font-bold py-3 px-8 rounded-xl hover:bg-indigo-600 transition duration-300 shadow-md hidden" onclick="nextSentence()">
                    Siguiente Oración &rarr;
                </button>
                <button id="restart-button" class="bg-green-500 text-white font-bold py-3 px-8 rounded-xl hover:bg-green-600 transition duration-300 shadow-md hidden" onclick="initializeGame()">
                    Reiniciar Juego
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuración de la base de datos de 30 oraciones
        const allSentences = [
            // 1ª Persona (Yo / Nosotros)
            { sentence: "Mi hermano me dio la llave.", pronoun: "me", type: "átono", person: 1, number: "singular" },
            { sentence: "El profesor te felicitó por tu trabajo.", pronoun: "te", type: "átono", person: 2, number: "singular" }, 
            { sentence: "Ellos vieron el río desbordarse.", pronoun: "Ellos", type: "tónico", person: 3, number: "plural" },
            { sentence: "Con nosotros todo es más fácil.", pronoun: "nosotros", type: "tónico", person: 1, number: "plural" },
            { sentence: "Mi hermana la vio en el cine.", pronoun: "la", type: "átono", person: 3, number: "singular" },
            { sentence: "Esto no nos beneficia.", pronoun: "nos", type: "átono", person: 1, number: "plural" },
            { sentence: "Mi abuelo viene conmigo al mercado.", pronoun: "conmigo", type: "tónico", person: 1, number: "singular" }, 
            { sentence: "Mi tía le regaló una flor.", pronoun: "le", type: "átono", person: 3, number: "singular" },
            { sentence: "El líder confía en sí mismo.", pronoun: "sí", type: "tónico", person: 3, number: "singular" },
            { sentence: "Mis amigos están con nosotras.", pronoun: "nosotras", type: "tónico", person: 1, number: "plural" },
            
            // 2ª Persona (Tú/Vos/Ustedes / Vosotros)
            // Oración 11 (Índice 10) - Cambio solicitado: Ella, tónico, 3ª, singular.
            { sentence: "Ella vio un perro en la calle.", pronoun: "Ella", type: "tónico", person: 3, number: "singular" },
            { sentence: "El regalo es para ti.", pronoun: "ti", type: "tónico", person: 2, number: "singular" },
            // Oración 13 (Índice 12) - Cambio solicitado: explicación sobre 'te' en "comprarte".
            { 
                sentence: "Quiero comprarte un regalo.", 
                pronoun: "te", 
                type: "átono", 
                person: 2, 
                number: "singular" 
            }, // Nota: El pronombre átono 'te' se fusiona con el verbo en infinitivo ('comprar'), formando un único vocablo.
            { sentence: "Trae las flores contigo.", pronoun: "contigo", type: "tónico", person: 2, number: "singular" },
            { sentence: "¿Quién os trajo el paquete?", pronoun: "os", type: "átono", person: 2, number: "plural" },
            { sentence: "Te hemos visto trabajar mucho.", pronoun: "te", type: "átono", person: 2, number: "singular" },
            { sentence: "Aquel coche es de ustedes.", pronoun: "ustedes", type: "tónico", person: 2, number: "plural" },
            // Oración 18 (Índice 17) - Cambio solicitado: "No os lo creáis tanto", átono, 2ª, plural.
            { sentence: "No os lo creáis tanto.", pronoun: "os", type: "átono", person: 2, number: "plural" }, 
            // Oración 19 (Índice 18) - Cambio solicitado: "Mi equipo debe ir con vosotros."
            { sentence: "Mi equipo debe ir con vosotros.", pronoun: "vosotros", type: "tónico", person: 2, number: "plural" }, 
            { sentence: "Os quiero decir la verdad.", pronoun: "os", type: "átono", person: 2, number: "plural" },
            
            // 3ª Persona (Él/Ella/Ello/Ellos/Ellas/Ustedes)
            { sentence: "Los estudiantes lo hicieron muy bien.", pronoun: "lo", type: "átono", person: 3, number: "singular" },
            { sentence: "Las niñas se fueron temprano.", pronoun: "se", type: "átono", person: 3, number: "plural" },
            // Oración 23 (Índice 22) - Cambio solicitado: "Mikel siempre trae el libro consigo."
            { sentence: "Mikel siempre trae el libro consigo.", pronoun: "consigo", type: "tónico", person: 3, number: "singular" }, 
            { sentence: "Mi amiga se puso contenta.", pronoun: "se", type: "átono", person: 3, number: "singular" },
            { sentence: "Esperamos a ellas en la esquina.", pronoun: "ellas", type: "tónico", person: 3, number: "plural" }, 
            // Oración 26 (Índice 25) - Cambio solicitado: "Le dimos el regalo", átono, 3ª, singular.
            { sentence: "Le dimos el regalo.", pronoun: "le", type: "átono", person: 3, number: "singular" },
            { sentence: "Los chicos le cantaron una canción.", pronoun: "le", type: "átono", person: 3, number: "singular" },
            { sentence: "Compró esa casa para sí mismo.", pronoun: "sí", type: "tónico", person: 3, number: "singular" },
            { sentence: "La casa la compró mi abuelo.", pronoun: "la", type: "átono", person: 3, number: "singular" },
            { sentence: "Los niños corren tras ellos.", pronoun: "ellos", type: "tónico", person: 3, number: "plural" } 
        ];

        let sentences = []; // Usaremos una copia aleatoria o la versión completa
        let currentSentenceIndex = 0;
        let score = 0;
        let classificationStep = 'type'; // 'type', 'person', 'number'

        // Estado de la selección
        let state = {
            pronounSelected: false,
            typeCorrect: false,
            personCorrect: false,
            numberCorrect: false,
            stepsCompleted: 0
        };

        // Elementos del DOM
        const sentenceEl = document.getElementById('current-sentence');
        const progressEl = document.getElementById('progress-display');
        const feedbackEl = document.getElementById('feedback-message');
        const nextButton = document.getElementById('next-button');
        const restartButton = document.getElementById('restart-button');

        // Inicializa el juego
        function initializeGame() {
            // Reiniciar variables
            sentences = [...allSentences]; // Usa la lista completa de 30 oraciones
            currentSentenceIndex = 0;
            score = 0;
            updateProgressDisplay();
            restartButton.classList.add('hidden');
            feedbackEl.textContent = '¡Comencemos! Elige el pronombre.';

            renderSentence();
        }

        // Renderiza la oración actual
        function renderSentence() {
            if (currentSentenceIndex >= sentences.length) {
                // Fin del juego
                showFinalScore();
                return;
            }

            const currentData = sentences[currentSentenceIndex];
            const words = currentData.sentence.split(/\s+/); // Separar por espacios
            let html = '';

            // Renderiza cada palabra como un span clickeable
            words.forEach(word => {
                // Limpia la palabra para comparación, manteniendo la puntuación para el display
                const cleanWord = word.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").trim();
                
                // Si la palabra contiene el pronombre (o es el pronombre), le damos un ID para el listener.
                // Manejo especial para pronombres pegados (Dímelo -> me, lo) o pronombre completo
                
                html += `<span data-word="${cleanWord}" class="word inline-block mr-1 cursor-pointer transition duration-150 p-1 select-none">${word}</span> `;
            });

            sentenceEl.innerHTML = html;
            resetClassificationSteps();
            resetState();
            updateProgressDisplay(); // Actualiza el progreso al cargar la nueva oración

            // Asigna el evento click a cada palabra
            document.querySelectorAll('#current-sentence .word').forEach(span => {
                span.addEventListener('click', handleWordClick);
            });
        }

        // Maneja el click en una palabra para seleccionar el pronombre
        function handleWordClick(event) {
            // Solo permite selección de pronombre si no ha sido seleccionado aún
            if (state.pronounSelected) return;

            const selectedSpan = event.target;
            const wordText = selectedSpan.textContent.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").trim();
            const currentData = sentences[currentSentenceIndex];

            // 1. Limpiar selecciones anteriores (si las hay)
            document.querySelectorAll('#current-sentence .word').forEach(span => {
                span.classList.remove('correct-pronoun', 'incorrect-selection');
            });

            // 2. Verificar si es el pronombre
            let isCorrect = false;

            // Manejo de pronombres pegados (e.g., "comprarte" -> te) o pronombres tónicos completos
            // Se verifica si la palabra seleccionada *contiene* el pronombre correcto
            if (selectedSpan.textContent.toLowerCase().includes(currentData.pronoun.toLowerCase())) {
                
                // Regla: Si la palabra completa coincide O el pronombre es átono (y por lo tanto, puede estar pegado al verbo)
                if (wordText.toLowerCase() === currentData.pronoun.toLowerCase() || currentData.type === 'átono') {
                    isCorrect = true;
                }
            }


            if (isCorrect) {
                selectedSpan.classList.add('correct-pronoun');
                feedbackEl.textContent = '¡Correcto! Ahora clasifica el pronombre.';
                state.pronounSelected = true;
                
                // Activar el primer paso de clasificación
                activateClassificationStep('type');
                
            } else {
                selectedSpan.classList.add('incorrect-selection');
                feedbackEl.textContent = 'Esa no es la palabra correcta. Intenta de nuevo.';
                setTimeout(() => {
                    selectedSpan.classList.remove('incorrect-selection');
                    feedbackEl.textContent = 'Elige el pronombre personal.';
                }, 1500);
            }
        }

        // Activa el siguiente set de botones de clasificación
        function activateClassificationStep(step) {
            document.querySelectorAll(`.classification-button[data-category="${step}"]`).forEach(btn => {
                btn.classList.remove('inactive');
                btn.classList.add('active');
                btn.addEventListener('click', handleClassificationClick);
            });
        }

        // Desactiva un set de botones de clasificación
        function deactivateClassificationStep(step) {
             document.querySelectorAll(`.classification-button[data-category="${step}"]`).forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('inactive');
                btn.removeEventListener('click', handleClassificationClick);
            });
        }

        // Maneja el click en los botones de clasificación
        function handleClassificationClick(event) {
            const button = event.target;
            const category = button.dataset.category;
            const value = button.dataset.value;
            const currentData = sentences[currentSentenceIndex];

            // 1. Verificar si el paso está activo
            if (!button.classList.contains('active')) return;

            // 2. Limpiar selecciones previas en la misma categoría
            document.querySelectorAll(`.classification-button[data-category="${category}"]`).forEach(btn => {
                btn.classList.remove('selected', 'correct', 'incorrect');
            });

            // 3. Marcar la selección actual
            button.classList.add('selected');

            // 4. Validar
            let isCorrect = false;
            let nextStep = null;

            if (category === 'type' && value === currentData.type) {
                state.typeCorrect = true;
                nextStep = 'person';
                isCorrect = true;
            } else if (category === 'person' && parseInt(value) === currentData.person) {
                state.personCorrect = true;
                nextStep = 'number';
                isCorrect = true;
            } else if (category === 'number' && value === currentData.number) {
                state.numberCorrect = true;
                nextStep = 'done';
                isCorrect = true;
            }

            // 5. Feedback y Progresión
            if (isCorrect) {
                button.classList.remove('selected');
                button.classList.add('correct');
                feedbackEl.textContent = `¡Muy bien! Clasificación de ${category} correcta.`;
                state.stepsCompleted++;
                deactivateClassificationStep(category);

                if (nextStep === 'done') {
                    // Todos los pasos completados
                    score++;
                    updateProgressDisplay();
                    feedbackEl.textContent = '¡Felicidades! Clasificación completa y correcta. Puedes pasar a la siguiente oración.';
                    nextButton.classList.remove('hidden');
                    // Desactivar todos los listeners para evitar cambios
                    document.querySelectorAll('#current-sentence .word').forEach(span => {
                        span.removeEventListener('click', handleWordClick);
                    });
                } else {
                    // Activar el siguiente paso
                    activateClassificationStep(nextStep);
                }
            } else {
                button.classList.remove('selected');
                button.classList.add('incorrect');
                feedbackEl.textContent = `Error en ${category}. Intenta otra opción.`;
                // El usuario debe corregir antes de avanzar.
            }
        }

        // Pasa a la siguiente oración
        function nextSentence() {
            currentSentenceIndex++;
            nextButton.classList.add('hidden');
            renderSentence();
        }

        // Muestra el puntaje final
        function showFinalScore() {
            sentenceEl.innerHTML = `<p class="text-3xl font-bold text-indigo-700">Juego Terminado</p>`;
            feedbackEl.textContent = `¡Has completado las ${sentences.length} oraciones! Tu puntaje final es: ${score} de ${sentences.length}.`;
            
            // Ocultar clasificación y mostrar reiniciar
            document.getElementById('classification-area').classList.add('hidden');
            restartButton.classList.remove('hidden');
            updateProgressDisplay(); // Para mostrar el resultado final
        }

        // Resetea el estado del juego para la nueva oración
        function resetState() {
            state = {
                pronounSelected: false,
                typeCorrect: false,
                personCorrect: false,
                numberCorrect: false,
                stepsCompleted: 0
            };
            document.getElementById('classification-area').classList.remove('hidden');
        }

        // Limpia todos los botones de clasificación y los desactiva
        function resetClassificationSteps() {
            nextButton.classList.add('hidden');
            feedbackEl.textContent = 'Elige el pronombre personal.';
            document.querySelectorAll('.classification-button').forEach(btn => {
                btn.classList.remove('active', 'selected', 'correct', 'incorrect');
                btn.classList.add('inactive');
                btn.removeEventListener('click', handleClassificationClick);
            });
        }

        // Actualiza el contador de progreso y las preguntas restantes
        function updateProgressDisplay() {
            const total = sentences.length;
            const current = currentSentenceIndex + 1;
            const remaining = total - currentSentenceIndex - 1;
            
            // Muestra el puntaje final si el juego ha terminado
            if (currentSentenceIndex >= total) {
                progressEl.innerHTML = `<span class="text-green-600">Puntaje Final: ${score}/${total}</span>`;
            } else {
                // Formato: Pregunta X de Y | Quedan Z por clasificar.
                progressEl.innerHTML = `<span class="text-gray-800 font-bold">Pregunta ${current} de ${total}</span> | <span class="text-indigo-600">Quedan ${remaining}</span>`;
            }
        }

        // Iniciar el juego al cargar la página
        window.onload = initializeGame;

    </script>
</body>
</html>